<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Polvo de Estrellas Etereal</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { margin: 0; background: #020205; overflow: hidden; touch-action: none; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>

    <script type="py">
from pyscript import window, document
from pyodide.ffi import create_proxy
import random
import math

canvas = document.getElementById("canvas")
ctx = canvas.getContext("2d")

def resize(event=None):
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight

resize()
window.addEventListener("resize", create_proxy(resize))

particles = []

class Particle:
    def __init__(self, x, y):
        self.x = x
        self.y = y
        # Velocidad más lenta y errática
        self.vx = (random.random() - 0.5) * 2
        self.vy = (random.random() - 0.5) * 2 - 0.5 # Tienden a subir
        self.size = random.random() * 2 + 0.5 # Muy pequeñas
        # Colores etéreos (cian, violeta, blanco, oro)
        h = random.choice([180, 280, 300, 45, 200])
        self.color = f"hsl({h}, 100%, 80%)"
        self.life = 1.0
        self.decay = random.random() * 0.01 + 0.005

    def update(self):
        self.x += self.vx
        self.y += self.vy
        self.life -= self.decay
        self.size *= 0.98

    def draw(self):
        if self.life <= 0: return
        ctx.save()
        ctx.globalAlpha = self.life
        ctx.fillStyle = self.color
        # Efecto de brillo
        ctx.shadowBlur = 8
        ctx.shadowColor = self.color
        ctx.beginPath()
        ctx.arc(self.x, self.y, self.size, 0, math.pi * 2)
        ctx.fill()
        ctx.restore()

def handle_interaction(e):
    if hasattr(e, 'touches'):
        x, y = e.touches.item(0).clientX, e.touches.item(0).clientY
    else:
        x, y = e.clientX, e.clientY
    
    # Crear muchas partículas diminutas
    for _ in range(3):
        particles.append(Particle(x, y))

interaction_proxy = create_proxy(handle_interaction)
canvas.addEventListener("mousemove", interaction_proxy)
canvas.addEventListener("touchmove", interaction_proxy)

def run_animation(*args):
    # Fondo casi opaco para dejar estelas largas
    ctx.fillStyle = "rgba(2, 2, 5, 0.15)"
    ctx.fillRect(0, 0, canvas.width, canvas.height)

    for p in particles[:]:
        p.update()
        p.draw()
        if p.life <= 0:
            particles.remove(p)
    
    window.requestAnimationFrame(create_proxy(run_animation))

run_animation()
    </script>
</body>
</html>
