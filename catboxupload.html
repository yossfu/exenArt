<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subir imágenes a Catbox.moe</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f4f4; }
        .upload-area { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; margin-bottom: 30px; }
        #file-input { margin: 20px 0; }
        button { padding: 12px 30px; background: #00a2ff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:disabled { background: #aaa; cursor: not-allowed; }
        .feed { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .feed img { width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .loading { color: #666; font-style: italic; }
    </style>
</head>
<body>

<h1>Sube tus imágenes a Catbox.moe</h1>

<div class="upload-area">
    <p>Selecciona una o varias imágenes</p>
    <input type="file" id="file-input" accept="image/*" multiple>
    <br>
    <button id="upload-btn">Subir imágenes</button>
    <p id="status"></p>
</div>

<h2>Feed de imágenes subidas</h2>
<div class="feed" id="feed">
    <!-- Las imágenes aparecerán aquí -->
</div>

<script>
// Cargar imágenes guardadas al iniciar (opcional)
const feed = document.getElementById('feed');
const savedImages = JSON.parse(localStorage.getItem('catboxImages') || '[]');
savedImages.reverse().forEach(url => addImageToFeed(url));

document.getElementById('upload-btn').addEventListener('click', async () => {
    const files = document.getElementById('file-input').files;
    const status = document.getElementById('status');
    const btn = document.getElementById('upload-btn');
    
    if (files.length === 0) {
        status.textContent = '⚠️ Por favor selecciona al menos una imagen';
        return;
    }

    btn.disabled = true;
    status.textContent = 'Subiendo...';

    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        status.textContent = `Subiendo ${i + 1}/${files.length}: ${file.name}...`;

        try {
            const url = await uploadToCatbox(file);
            addImageToFeed(url);
            saveToLocalStorage(url);
            status.textContent = `¡Subido! ${i + 1}/${files.length}`;
        } catch (err) {
            status.textContent = `Error con ${file.name}: ${err.message}`;
        }
    }

    status.textContent = '¡Todas las imágenes se han subido!';
    btn.disabled = false;
    document.getElementById('file-input').value = ''; // limpiar selector
});

async function uploadToCatbox(file) {
    const formData = new FormData();
    formData.append('reqtype', 'fileupload');
    formData.append('fileToUpload', file);

    const response = await fetch('https://catbox.moe/user/api.php', {
        method: 'POST',
        body: formData
    });

    if (!response.ok) {
        throw new Error('Error en la subida');
    }

    const url = await response.text();
    if (url.includes('catbox.moe')) {
        return url.trim();
    } else {
        throw new Error('Respuesta inválida del servidor');
    }
}

function addImageToFeed(url) {
    const img = document.createElement('img');
    img.src = url;
    img.alt = 'Imagen subida a catbox';
    img.loading = 'lazy';
    
    // Opcional: al hacer clic abre la imagen original
    img.onclick = () => window.open(url, '_blank');
    img.style.cursor = 'pointer';
    
    feed.prepend(img); // prepend = nueva arriba
}

function saveToLocalStorage(url) {
    const saved = JSON.parse(localStorage.getItem('catboxImages') || '[]');
    saved.push(url);
    localStorage.setItem('catboxImages', JSON.stringify(saved));
}
</script>

</body>
</html>