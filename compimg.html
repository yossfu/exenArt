El error "Failed to fetch" persiste porque la mayoría de las APIs públicas de generación de imágenes, incluso las gratuitas como Raphael AI, no permiten llamadas directas desde el navegador debido a restricciones CORS (Cross-Origin Resource Sharing). Esto es una medida de seguridad que impide que páginas web hagan peticiones a dominios externos sin permiso explícito.

 

Solución definitiva para hacer funcionar la generación real de imágenes desde un HTML:

1. Necesitas un backend proxy que haga la llamada a la API y devuelva la imagen al frontend.

El navegador hará la petición a tu backend (que está en el mismo origen o que controla CORS).
El backend hará la petición a la API externa (sin restricciones CORS).
El backend devuelve la respuesta al navegador.

 

2. Ejemplo básico de backend proxy en Node.js con Express

 
// server.js
const express = require('express');
const fetch = require('node-fetch');
const cors = require('cors');

const app = express();
app.use(cors()); // Permitir CORS para frontend
app.use(express.json());

app.post('/generate-image', async (req, res) => {
  const { prompt, negative_prompt } = req.body;

  try {
    const response = await fetch('https://api.raphael.app/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt, negative_prompt }),
    });

    if (!response.ok) {
      return res.status(response.status).json({ error: 'Error en API externa' });
    }

    const data = await response.json();
    res.json(data);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

const PORT = 3000;
app.listen(PORT, () => {
  console.log(`Servidor proxy escuchando en puerto ${PORT}`);
});
 

 

3. Modificación del HTML para llamar a tu backend proxy

 
<script>
  const generateBtn = document.getElementById('generateBtn');
  const promptPositive = document.getElementById('promptPositive');
  const promptNegative = document.getElementById('promptNegative');
  const resultDiv = document.getElementById('result');
  const loadingDiv = document.getElementById('loading');

  generateBtn.addEventListener('click', async () => {
    const positive = promptPositive.value.trim();
    const negative = promptNegative.value.trim();

    if (!positive) {
      alert('Por favor, ingresa un prompt positivo.');
      return;
    }

    resultDiv.innerHTML = '';
    loadingDiv.style.display = 'block';

    try {
      // Cambia la URL al endpoint de tu backend proxy
      const response = await fetch('http://localhost:3000/generate-image', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: positive, negative_prompt: negative }),
      });

      if (!response.ok) {
        throw new Error(`Error en el servidor: ${response.statusText}`);
      }

      const data = await response.json();

      if (!data.image_url) {
        throw new Error('No se recibió URL de imagen');
      }

      const img = document.createElement('img');
      img.src = data.image_url;
      img.alt = 'Imagen generada';
      resultDiv.appendChild(img);

    } catch (error) {
      alert('Error al generar la imagen: ' + error.message);
    } finally {
      loadingDiv.style.display = 'none';
    }
  });
</script>
 

 